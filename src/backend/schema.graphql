# src/backend/schema.graphql

type Resume {
  resumeId: Int!
  userId: Int!
  filename: String
  url: String
  uploadedAt: String
  calculatedExperience: Int
  skills: [String]
}

type User {
  UserID: Int!
  email: String!
  firstName: String!
  lastName: String!
  role: String!
  phone_number: String
  city: String
  state_province: String
  country: String
  linkedin_profile: String
  portfolio_url: String
  highest_qualification: String
  years_of_experience: Int
  createdAt: String
  dob: String
  skills: [String]
  professionalTitle: String
  is_us_citizen: Boolean
  highest_degree_year: Int
  applicationStatus: String
  resume_url: String
  interviewTime: String 
  resumes: [Resume!]  # <--- NEW FIELD
}

input UserInput {
  firstName: String!
  lastName: String!
  email: String!
  role: String!
  phone_number: String
  city: String
  state_province: String
  country: String
  linkedin_profile: String
  portfolio_url: String
  highest_qualification: String
  years_of_experience: Int
  dob: String
  skills: [String]
  professionalTitle: String
}

input UserUpdateInput {
  firstName: String
  lastName: String
  phone_number: String
  city: String
  state_province: String
  country: String
  linkedin_profile: String
  portfolio_url: String
  highest_qualification: String
  years_of_experience: Int
  dob: String
  skills: [String]
  professionalTitle: String
  is_us_citizen: Boolean
  highest_degree_year: Int
}

type Job {
  jobId: Int!
  title: String!
  company: String
  location: String
  salaryRange: String
  skillsRequired: [String]
  description: String
  postedAt: String
  applicants: [User!]
  applicationCount: Int!
  requires_us_citizenship: Boolean
  minimum_degree_year: Int
  status: String
  posterUserId: Int
  posterName: String
  # --- NEW FIELDS ---
  hiringManagerId: Int
  hiringManagerName: String
}

input JobInput {
  title: String!
  company: String
  location: String
  salaryRange: String
  skillsRequired: [String]
  description: String
  requires_us_citizenship: Boolean
  hiringManagerId: Int
  hiringManagerName: String
}

input JobUpdateInput {
  title: String
  company: String
  location: String
  salaryRange: String
  skillsRequired: [String]
  description: String
  requires_us_citizenship: Boolean
  minimum_degree_year: Int
  status: String
  hiringManagerId: Int
  hiringManagerName: String
}

type Application {
  appId: Int!
  userId: Int!
  jobId: Int!
  status: String!
  submittedAt: String!
  notes: String
  candidate: User
  job: Job
  resume_url: String
  userName: String
  jobTitle: String
  companyName: String
  emailSent: String
}

input ApplicationInput {
  userId: Int!
  jobId: Int!
  notes: String
}

input ApplicationUpdateInput {
  status: String
  notes: String
}

type AvailabilitySlot {
  dayOfWeek: String!
  startTime: String!
  endTime: String!
}

input AvailabilityInput {
  dayOfWeek: String!
  startTime: String!
  endTime: String!
}

type Interview {
  interviewId: Int!
  jobId: Int!
  candidateId: Int!
  recruiterId: Int!
  hiringManagerId: Int
  startTime: String!
  endTime: String!
  job: Job
  candidate: User
}

type Query {
  users(
    limit: Int
    skip: Int
    firstName: String
    lastName: String
    dob: String
    skills: [String!]
    isUSCitizen: Boolean
    yearsOfExperience_gte: Int
  ): [User!]!
  userById(UserID: Int!): User
  jobs(
    limit: Int
    skip: Int
    company: String
    location: String
    title: String
    posterUserId: Int
  ): [Job!]!
  jobById(jobId: Int!): Job
  applications(userId: Int, jobId: Int, status: String): [Application!]!
  applicationById(appId: Int!): Application
  mySchedule: [AvailabilitySlot!]
  findAvailableSlots(
    jobId: Int!
    candidateId: Int!
    durationMinutes: Int
    numDays: Int
  ): [String!]!
  
  # --- NEW QUERY (FS.4) ---
  """
  Returns a list of interviews where the logged-in user is the Recruiter or Hiring Manager.
  """
  myBookedInterviews: [Interview!]!
}

type Mutation {
  createUser(input: UserInput!): User!
  updateUser(UserID: Int!, input: UserUpdateInput!): User!
  updateUserByName(firstName: String, lastName: String, input: UserUpdateInput!): User!
  deleteUser(UserID: Int!): Boolean!
  deleteUserByFields(firstName: String, lastName: String, dob: String): Boolean!
  createJob(input: JobInput!): Job!
  updateJob(jobId: Int!, input: JobUpdateInput!): Job
  updateJobByFields(title: String!, company: String, input: JobUpdateInput!): Job
  deleteJob(jobId: Int!): Boolean!
  addSkillsToJob(jobId: Int!, skills: [String!]!): Job
  deleteJobByFields(title: String!, company: String): Boolean!
  createApplication(input: ApplicationInput!): Application!
  apply(userName: String!, jobTitle: String!, companyName: String): Application!
  updateApplication(appId: Int!, input: ApplicationUpdateInput!): Application
  addSkillsToUser(UserID: Int!, skills: [String!]!): User
  updateApplicationStatusByNames(
    userName: String!
    jobTitle: String!
    companyName: String
    newStatus: String!
  ): Application
  addNoteToApplicationByJob(
    jobTitle: String!
    note: String!
    companyName: String
  ): Application
  addManagerNoteToApplication(
    userName: String!
    jobTitle: String!
    companyName: String
    note: String!
  ): Application
  setMyAvailability(availability: [AvailabilityInput!]!): Boolean!
  bookInterview(jobId: Int!, candidateId: Int!, startTime: String!, endTime: String!): Interview
  bookInterviewByNaturalLanguage(
    candidateName: String!
    jobTitle: String!
    companyName: String
    startTimeISO: String!
  ): Interview

  # --- NEW MUTATION (FS.2) ---
  """
  Allows an Applicant to finalize a booking for an application that is in 'InterviewInviteSent' status.
  """
  selectInterviewSlot(
    appId: Int!
    startTime: String!
  ): Interview!

  # --- NEW MUTATIONS FOR FEATURE 2.2.6 ---
  applyWithResume(
    userName: String!
    jobTitle: String!
    companyName: String
    resumeId: Int!
  ): Application!

  deleteResume(resumeId: Int!): Boolean!
}